<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Halajobs.qa</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg,#f5f7fa,#c3cfe2);
      margin:0;padding:0;min-height:100vh;
    }
    header {
      background:#fff;backdrop-filter:blur(10px);
      padding:15px;text-align:center;
      box-shadow:0 4px 20px rgba(0,0,0,0.1);
      position:sticky;top:0;z-index:1000;
    }
    header h1 { margin:0;font-size:26px;color:#2c3e50;font-weight:700; }
    .top-controls { margin-top:15px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap; }
    .top-controls input,.top-controls select {
      padding:10px;font-size:14px;border:2px solid #e0e6ed;
      border-radius:8px;background:white;transition:.3s;min-width:120px;
    }
    .top-controls input:focus,.top-controls select:focus {
      outline:none;border-color:#007bff;box-shadow:0 0 0 3px rgba(0,123,255,.1);
    }
    .post-btn {
      padding:10px 16px;background:linear-gradient(45deg,#007bff,#0056b3);
      color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;
      transition:.3s;text-transform:uppercase;
    }
    .post-btn:hover {transform:translateY(-2px);box-shadow:0 4px 15px rgba(0,123,255,.3);}
    main {max-width:900px;margin:20px auto;padding:0 15px;}
    .job-card {
      background:#fff;backdrop-filter:blur(10px);
      border-radius:15px;padding:20px;margin-bottom:20px;
      box-shadow:0 8px 30px rgba(0,0,0,.1);
      transition:.3s;border:1px solid rgba(0,0,0,.05);
    }
    .job-card:hover {transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,.15);}
    .job-card h3 {margin:0 0 10px;color:#007bff;font-size:18px;}
    .job-card p {margin:8px 0;color:#555;}
    .job-meta {display:flex;flex-wrap:wrap;gap:15px;margin:10px 0;}
    .meta-item {display:flex;align-items:center;gap:5px;font-size:14px;color:#666;}
    .share-btn {
      background:linear-gradient(45deg,#25d366,#128c7e);
      color:white;border:none;padding:6px 12px;
      border-radius:8px;cursor:pointer;font-size:14px;
    }
    .share-btn:hover {box-shadow:0 4px 15px rgba(37,211,102,.3);}
    footer {text-align:center;padding:20px;margin-top:40px;
      background:#fff;backdrop-filter:blur(10px);
      border-top:1px solid rgba(0,0,0,.1);color:#666;font-size:14px;}
    /* Modal */
    .modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,.6);backdrop-filter:blur(5px);
      justify-content:center;align-items:center;z-index:2000;}
    .modal-content {
      background:white;padding:30px;border-radius:20px;max-width:450px;width:90%;
      max-height:90vh;overflow-y:auto;position:relative;
    }
    .modal-content input,.modal-content textarea,.modal-content select {
      width:100%;padding:10px;margin:6px 0;border:2px solid #e0e6ed;border-radius:10px;
    }
    .modal-content button {width:100%;padding:12px;margin-top:10px;
      background:linear-gradient(45deg,#007bff,#0056b3);
      color:white;border:none;border-radius:10px;cursor:pointer;font-weight:600;}
    .success,.error {display:none;text-align:center;font-weight:bold;padding:8px;margin-top:10px;border-radius:8px;}
    .success {color:#28a745;background:#d4edda;}
    .error {color:#dc3545;background:#f8d7da;}
    .admin-active body {background:#fff0f0;}
    .admin-badge {
      position:fixed;top:10px;right:10px;background:red;color:white;
      padding:5px 10px;border-radius:8px;font-weight:bold;
      animation:pulse 1s infinite;z-index:3000;
    }
    @keyframes pulse {0%{opacity:1}50%{opacity:.6}100%{opacity:1}}
    .admin-panel {
      position:fixed;top:50px;right:10px;background:white;
      border:2px solid red;padding:10px;border-radius:10px;
      font-size:14px;z-index:3000;display:none;
    }
    .delete-btn {
      background:red;color:white;border:none;padding:5px 8px;
      border-radius:6px;cursor:pointer;font-size:12px;margin-top:8px;
    }
    .delete-btn:hover {background:darkred;}
  </style>
</head>
<body>
  <header>
    <h1>üá∂üá¶ Halajobs.qa</h1>
    <div class="top-controls">
      <input type="text" id="search" placeholder="üîç Search jobs...">
      <select id="categoryFilter">
        <option value="all">All Categories</option>
        <option>Helper</option><option>Driver</option><option>Engineer</option>
        <option>Accountant</option><option>Delivery</option><option>Sales</option>
        <option>IT</option><option>Healthcare</option><option>Others</option>
      </select>
      <button class="post-btn" id="openModal">+ Post Job</button>
    </div>
  </header>

  <main id="jobsList"><div>Loading jobs...</div></main>

  <footer>¬© 2025 Halajobs.qa ‚Äî Your Gateway to Jobs in Qatar</footer>

  <!-- Admin -->
  <div id="adminBadge" class="admin-badge" style="display:none;">ADMIN MODE</div>
  <div id="adminPanel" class="admin-panel"></div>

  <!-- Modal -->
  <div class="modal" id="jobModal">
    <div class="modal-content">
      <h2>Post a New Job</h2>
      <input type="text" id="position" placeholder="Job Position *">
      <textarea id="description" placeholder="Job Description *"></textarea>
      <input type="text" id="salary" placeholder="Salary">
      <input type="text" id="company" placeholder="Company *">
      <input type="text" id="location" placeholder="Location">
      <select id="category">
        <option value="">Select Category *</option>
        <option>Helper</option><option>Driver</option><option>Engineer</option>
        <option>Accountant</option><option>Delivery</option><option>Sales</option>
        <option>IT</option><option>Healthcare</option><option>Others</option>
      </select>
      <input type="file" id="poster" accept="image/*">
      <button id="submitJob">üöÄ Post Job</button>
      <div class="success" id="successMsg">‚úÖ Job Posted!</div>
      <div class="error" id="errorMsg">‚ùå Error posting job.</div>
      <button onclick="document.getElementById('jobModal').style.display='none'">Close</button>
    </div>
  </div>

<script>
  // --- Supabase Init ---
  const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co";
  const SUPABASE_KEY = "YOUR-ANON-KEY";
  const { createClient } = supabase;
  const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

  // --- DOM refs ---
  const jobsList=document.getElementById('jobsList');
  const modal=document.getElementById('jobModal');
  const openModal=document.getElementById('openModal');
  const submitJob=document.getElementById('submitJob');
  const successMsg=document.getElementById('successMsg');
  const errorMsg=document.getElementById('errorMsg');
  const search=document.getElementById('search');
  const categoryFilter=document.getElementById('categoryFilter');

  // --- State ---
  let adminMode=false;let deletionCount=0;

  // --- Modal Controls ---
  openModal.onclick=()=>{modal.style.display="flex";}
  window.onclick=e=>{if(e.target==modal) modal.style.display="none";}

  // --- Load Jobs ---
  async function loadJobs(){
    jobsList.innerHTML="Loading jobs...";
    let {data,error}=await supabaseClient.from("jobs").select("*").order("created_at",{ascending:false});
    if(error){console.error(error);jobsList.innerHTML="Error loading jobs";return;}
    renderJobs(data);
  }

  function renderJobs(jobs){
    const searchTerm=search.value.toLowerCase();
    const category=categoryFilter.value;
    const filtered=jobs.filter(j=>
      (category==="all"||j.category===category) &&
      (!searchTerm||j.position.toLowerCase().includes(searchTerm)||j.company.toLowerCase().includes(searchTerm))
    );
    jobsList.innerHTML="";
    filtered.forEach(job=>{
      const card=document.createElement("div");
      card.className="job-card";
      card.innerHTML=`
        <h3>${job.position} - ${job.company}</h3>
        <p>üìã ${job.description}</p>
        <div class="job-meta">
          ${job.salary?`<div class="meta-item">üí∞ ${job.salary}</div>`:""}
          ${job.location?`<div class="meta-item">üìç ${job.location}</div>`:""}
        </div>
        ${job.poster_url?`<img src="${job.poster_url}" style="max-width:100%;border-radius:10px;">`:""}
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
          <small>üìÖ ${new Date(job.created_at).toLocaleDateString()}</small>
          <button class="share-btn" onclick="shareJob('${job.position}','${job.company}','${job.description}')">üì§ Share</button>
        </div>
      `;
      if(adminMode){
        card.style.border="2px solid red";
        card.innerHTML+=`<button class="delete-btn" onclick="deleteJob(${job.id},'${job.position}','${job.company}')">üóë Delete</button>
        <small>ID: ${job.id}</small>`;
      }
      jobsList.appendChild(card);
    });
    updateAdminPanel(filtered.length);
  }

  // --- Add Job ---
  submitJob.onclick=async()=>{
    const pos=document.getElementById("position").value.trim();
    const desc=document.getElementById("description").value.trim();
    const comp=document.getElementById("company").value.trim();
    const cat=document.getElementById("category").value;
    if(!pos||!desc||!comp||!cat){errorMsg.style.display="block";return;}
    submitJob.disabled=true;
    let newJob={position:pos,description:desc,company:comp,category:cat,created_at:new Date().toISOString(),expiry_timestamp:new Date(Date.now()+14*864e5).toISOString()};
    const {error}=await supabaseClient.from("jobs").insert([newJob]);
    submitJob.disabled=false;
    if(error){errorMsg.style.display="block";}else{successMsg.style.display="block";setTimeout(()=>{modal.style.display="none";loadJobs();},1500);}
  };

  // --- Share ---
  function shareJob(pos,comp,desc){
    const text=`üîπ ${pos} - ${comp}\nüìã ${desc}\nüåê Find more jobs at: https://farisconnects.github.io/halajobs-qa/`;
    navigator.clipboard.writeText(text).then(()=>alert("‚úÖ Copied to clipboard!"));
  }

  // --- Admin Mode ---
  document.addEventListener("keydown",e=>{
    if(e.ctrlKey&&e.shiftKey&&e.key==="M"){toggleAdmin();}
  });
  function toggleAdmin(){
    if(!adminMode){
      const code=prompt("Enter Admin Passcode:");
      if(code!=="451588"){alert("‚ùå Wrong passcode");return;}
      adminMode=true;document.getElementById("adminBadge").style.display="block";document.getElementById("adminPanel").style.display="block";
    }else{
      adminMode=false;document.getElementById("adminBadge").style.display="none";document.getElementById("adminPanel").style.display="none";
    }
    loadJobs();
  }
  async function deleteJob(id,pos,comp){
    if(!confirm(`Delete job: ${pos} at ${comp}?`))return;
    const code=prompt("Confirm Passcode:");if(code!=="451588")return;
    const {error}=await supabaseClient.from("jobs").delete().eq("id",id);
    if(!error){deletionCount++;console.log(`Deleted job ${id} at ${new Date().toISOString()}`);loadJobs();}
  }
  function updateAdminPanel(total){
    if(adminMode){
      document.getElementById("adminPanel").innerHTML=`
        <b>Admin Stats</b><br>
        Total Jobs: ${total}<br>
        Deletions this session: ${deletionCount}<br>
        Hotkey: Ctrl+Shift+M to exit`;
    }
  }

  // --- Search & filter ---
  search.oninput=()=>loadJobs();
  categoryFilter.onchange=()=>loadJobs();

  loadJobs();
</script>
</body>
</html>
