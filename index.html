<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Halajobs.qa — Your Gateway to Jobs in Qatar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f6fa;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #fff;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
      color: #2c3e50;
    }
    .search-filter {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .search-filter input, .search-filter select {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      min-width: 120px;
    }
    .add-btn {
      margin-top: 10px;
      padding: 8px 12px;
      font-size: 18px;
      background-color: #2c89f4;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .add-btn:hover {
      background-color: #1f6ed1;
    }
    main {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 10px;
    }
    .card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      padding: 15px;
      margin-bottom: 20px;
    }
    .post h3 {
      margin: 0;
      font-size: 16px;
      color: #2c3e50;
      word-wrap: break-word;
    }
    .post small {
      color: #888;
    }
    .post p {
      margin: 8px 0;
      font-size: 14px;
      word-wrap: break-word;
    }
    .post img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
    .share-btns {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .share-btns button {
      background-color: #eee;
      color: #333;
      border: 1px solid #ddd;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    .share-btns button:hover {
      background-color: #ddd;
    }
    footer {
      text-align: center;
      padding: 15px;
      font-size: 14px;
      background: #fff;
      border-top: 1px solid #eee;
      margin-top: 40px;
      color: #555;
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-content h2 {
      margin-top: 0;
      font-size: 18px;
    }
    .modal-content label {
      font-size: 14px;
      font-weight: bold;
      display: block;
      margin-top: 10px;
      margin-bottom: 4px;
    }
    .modal-content input, 
    .modal-content textarea, 
    .modal-content select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .modal-content textarea {
      resize: vertical;
      min-height: 60px;
    }
    .modal-content button {
      margin-top: 15px;
      padding: 10px 15px;
      background-color: #2c89f4;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    .modal-content button:hover {
      background-color: #1f6ed1;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #666;
    }
    .close-btn:hover {
      color: #000;
    }
    .success {
      color: green;
      font-size: 16px;
      font-weight: bold;
      display: none;
      margin-top: 10px;
    }
    .empty-state {
      text-align: center;
      color: #666;
      font-style: italic;
      padding: 40px 20px;
    }
    .error-msg {
      color: red;
      font-size: 14px;
      display: none;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Halajobs.qa</h1>
    <div class="search-filter">
      <input type="text" id="searchInput" placeholder="Search jobs...">
      <select id="categoryFilter"></select>
    </div>
    <button class="add-btn" onclick="openModal()">+ Post Job</button>
  </header>

  <main>
    <div id="feed"></div>
  </main>

  <footer>
    © 2025 Halajobs.qa — Your Gateway to Jobs in Qatar
  </footer>

  <!-- Modal -->
  <div class="modal" id="jobModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h2>Post a Job</h2>
      <form id="jobForm">
        <label>Position *</label>
        <input type="text" id="position" required>
        <div class="error-msg" id="positionError">Position is required</div>
        
        <label>Job Description *</label>
        <textarea id="description" required></textarea>
        <div class="error-msg" id="descriptionError">Job description is required</div>
        
        <label>Salary (optional)</label>
        <input type="text" id="salary" placeholder="e.g. 3000 QR/month">
        
        <label>Company Name *</label>
        <input type="text" id="company" required>
        <div class="error-msg" id="companyError">Company name is required</div>
        
        <label>Contact (Email or Phone) *</label>
        <input type="text" id="contact" required placeholder="email@example.com or +974xxxxxxxx">
        <div class="error-msg" id="contactError">Valid email or phone is required</div>
        
        <label>Category *</label>
        <select id="category" required></select>
        <div class="error-msg" id="categoryError">Please select a category</div>
        
        <label>Poster (optional)</label>
        <input type="file" id="poster" accept="image/*">
        
        <button type="button" onclick="postJob()">Post Job</button>
        <div class="success" id="successMsg">✅ Job Posted Successfully!</div>
      </form>
    </div>
  </div>

  <script>
    const categories = ["Driver", "IT", "Construction", "Hospitality", "Others"];
    const feedEl = document.getElementById("feed");
    const modal = document.getElementById("jobModal");
    const successMsg = document.getElementById("successMsg");

    // Populate categories
    function loadCategories() {
      const catFilter = document.getElementById("categoryFilter");
      const catSelect = document.getElementById("category");
      catFilter.innerHTML = `<option value="">All Categories</option>`;
      catSelect.innerHTML = `<option value="">Select Category</option>`;
      categories.forEach(c => {
        catFilter.innerHTML += `<option value="${c}">${c}</option>`;
        catSelect.innerHTML += `<option value="${c}">${c}</option>`;
      });
    }

    function validateContact(contact) {
      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
      const phoneRegex = /^\\+?\\d{7,15}$/;
      return emailRegex.test(contact) || phoneRegex.test(contact);
    }

    function openModal() {
      modal.style.display = "flex";
      clearForm();
      hideErrors();
    }

    function closeModal() {
      modal.style.display = "none";
      successMsg.style.display = "none";
      hideErrors();
    }

    function hideErrors() {
      document.querySelectorAll('.error-msg').forEach(el => el.style.display = 'none');
    }

    function showError(id) {
      const el = document.getElementById(id);
      if (el) el.style.display = 'block';
    }

    function validateForm() {
      hideErrors();
      let isValid = true;
      if (!document.getElementById("position").value.trim()) { showError("positionError"); isValid = false; }
      if (!document.getElementById("description").value.trim()) { showError("descriptionError"); isValid = false; }
      if (!document.getElementById("company").value.trim()) { showError("companyError"); isValid = false; }
      const contact = document.getElementById("contact").value.trim();
      if (!contact || !validateContact(contact)) { showError("contactError"); isValid = false; }
      if (!document.getElementById("category").value) { showError("categoryError"); isValid = false; }
      return isValid;
    }

    function loadJobs() {
      feedEl.innerHTML = "";
      let jobs = JSON.parse(localStorage.getItem("jobs") || "[]");
      const now = new Date();
      jobs = jobs.filter(job => new Date(job.expiry) > now);
      localStorage.setItem("jobs", JSON.stringify(jobs));

      const search = (localStorage.getItem("lastSearch") || "").toLowerCase();
      const category = localStorage.getItem("lastCategory") || "";

      document.getElementById("searchInput").value = search;
      document.getElementById("categoryFilter").value = category;

      const filteredJobs = jobs.filter(job => {
        const matchesSearch = !search ||
          job.position.toLowerCase().includes(search) ||
          job.description.toLowerCase().includes(search) ||
          job.company.toLowerCase().includes(search);
        const matchesCategory = !category || job.category === category;
        return matchesSearch && matchesCategory;
      });

      if (filteredJobs.length === 0) {
        feedEl.innerHTML = `<div class="empty-state">${
          jobs.length === 0 ? "No jobs posted yet. Be the first to post a job!" : "No jobs match your search."
        }</div>`;
        return;
      }

      filteredJobs.sort((a,b) => new Date(b.date)-new Date(a.date)).forEach(job => {
        const card = document.createElement("div");
        card.className = "card post";
        card.innerHTML = `
          <h3>🔹 ${job.position} - ${job.company}</h3>
          <p>📋 ${job.description}</p>
          ${job.salary ? `<p><strong>💰</strong> ${job.salary}</p>` : ""}
          <p><strong>📞</strong> ${job.contact}</p>
          <p><strong>Category:</strong> ${job.category}</p>
          ${job.poster ? `<img src="${job.poster}" alt="Job Poster" onerror="this.style.display='none'">` : ""}
          <div class="share-btns">
            <button onclick="shareWhatsApp(${jobs.indexOf(job)})">WhatsApp</button>
            <button onclick="shareFacebook(${jobs.indexOf(job)})">Facebook</button>
            <button onclick="copyLink(${jobs.indexOf(job)})">Copy Link</button>
          </div>`;
        feedEl.appendChild(card);
      });
    }

    function postJob() {
      if (!validateForm()) return;
      const fileInput = document.getElementById("poster");
      if (fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = e => saveJob(e.target.result);
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        saveJob("");
      }
    }

    function saveJob(posterData) {
      const job = {
        position: document.getElementById("position").value.trim(),
        description: document.getElementById("description").value.trim(),
        salary: document.getElementById("salary").value.trim(),
        company: document.getElementById("company").value.trim(),
        contact: document.getElementById("contact").value.trim(),
        category: document.getElementById("category").value,
        poster: posterData,
        date: new Date().toISOString(),
        expiry: new Date(Date.now()+14*24*60*60*1000).toISOString()
      };
      let jobs = JSON.parse(localStorage.getItem("jobs") || "[]");
      jobs.push(job);
      localStorage.setItem("jobs", JSON.stringify(jobs));
      successMsg.style.display = "block";
      setTimeout(closeModal, 1500);
      clearForm();
      loadJobs();
    }

    function clearForm() {
      ["position","description","salary","company","contact","category","poster"].forEach(id => document.getElementById(id).value = "");
    }

    function getJobByIndex(i) {
      const jobs = JSON.parse(localStorage.getItem("jobs") || "[]");
      return jobs[i];
    }

    function shareWhatsApp(i) {
      const job = getJobByIndex(i); if (!job) return;
      const text = `🔹 ${job.position} - ${job.company}\n📋 ${job.description}\n🌐 Find more details and jobs at: https://farisconnects.github.io/halajobs-qa/`;
      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, "_blank");
    }

    function shareFacebook(i) {
      const job = getJobByIndex(i); if (!job) return;
      const text = `🔹 ${job.position} - ${job.company}\n📋 ${job.description}`;
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent("https://farisconnects.github.io/halajobs-qa/")}&quote=${encodeURIComponent(text)}`, "_blank");
    }

    function copyLink(i) {
      const job = getJobByIndex(i); if (!job) return;
      const text = `🔹 ${job.position} - ${job.company}\n📋 ${job.description}\n🌐 Find more details and jobs at: https://farisconnects.github.io/halajobs-qa/`;
      navigator.clipboard.writeText(text).then(()=>alert("✅ Job details copied!"));
    }

    document.getElementById("searchInput").addEventListener("input", e => {
      localStorage.setItem("lastSearch", e.target.value);
      loadJobs();
    });
    document.getElementById("categoryFilter").addEventListener("change", e => {
      localStorage.setItem("lastCategory", e.target.value);
      loadJobs();
    });

    window.onclick = e => { if (e.target===modal) closeModal(); };
    document.addEventListener("keydown", e => { if (e.key==="Escape" && modal.style.display==="flex") closeModal(); });

    loadCategories();
    loadJobs();
  </script>
</body>
</html>
